{% extends 'base.html' %}
{% load staticfiles %}

{% block content %}
	<canvas style="width: 100vmin; height: 80vmin; background: black;" id="pixi-canvas"></canvas>
	<script src='{% static "/js/pixi.js" %}'></script>
	<script type="text/javascript">
		const canvas = document.getElementById('pixi-canvas');

		//Aliases
		let Application = PIXI.Application,
		    loader = PIXI.Loader.shared,
		    resources = PIXI.loader.resources,
		    Rectangle = PIXI.Rectangle,
		    TextureCache = PIXI.utils.TextureCache,
		    Sprite = PIXI.Sprite;

		const app = new Application({                    
		    view: canvas,
		    antialias: true,
			backgroundColor: 0x1099bb,
		});

		loader
		  	.add('{% static "/images/sprite-game.json" %}')
		 	.load(setup);

		let imgs, backCenter, backSide, backTop, door, player, pirate, big, cucumber, captain;
		function setup() {
			let spriteAttr = JSON.parse('{{json | escapejs}}');
			let centerW = spriteAttr.frames["center.png"].spriteSourceSize.w;
			let centerH = spriteAttr.frames["center.png"].spriteSourceSize.h;
  			imgs = resources['{% static "/images/sprite-game.json" %}'].textures;
  			for (let i = 0; centerW*i < canvas.width; i++) {
  				for (let j=0; centerH*j < canvas.height; j++) {
					backCenter = new Sprite(imgs["center.png"]);
					backCenter.position.set(centerW * i, centerH * j);
					app.stage.addChild(backCenter);
				}
  			}
  			

  			door = new Sprite(imgs["door.png"]);
  			door.position.set(400,100);
  			app.stage.addChild(door);

  			player = new Sprite(imgs["player.png"]);
  			player.position.set(100,100);
  			app.stage.addChild(player);

  			pirate = new Sprite(imgs["pirate.png"]);
  			pirate.position.set(300,100);
  			app.stage.addChild(pirate);

  			big = new Sprite(imgs["big.png"]);
  			big.position.set(300,400);
  			app.stage.addChild(big);

  			cucumber = new Sprite(imgs["cucumber.png"]);
  			cucumber.position.set(400,400);
  			app.stage.addChild(cucumber);

  			captain = new Sprite(imgs["captain.png"]);
  			captain.position.set(500,400);
  			app.stage.addChild(captain);
		}

		console.log(app.renderer.width);
		console.log(app.renderer.height);
	</script>
{% endblock %}